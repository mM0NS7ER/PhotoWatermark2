# 照片水印应用 - 开发环境配置文档

## 1. 环境配置概述

本文档详细介绍了如何搭建照片水印应用的开发环境，包括系统要求、开发工具安装、依赖库配置等内容。遵循本文档的步骤，开发人员可以快速搭建完整的开发环境，开始项目开发工作。

## 2. 系统要求

### 2.1 操作系统
- **Windows**: Windows 10 或更高版本 (64位)

### 2.2 硬件要求
- **CPU**: 双核及以上处理器
- **内存**: 最少8GB RAM，推荐16GB或以上
- **硬盘**: 至少10GB可用空间
- **显示器**: 分辨率1920×1080或更高

### 2.3 软件要求
- Git (版本控制)
- Python 3.8或更高版本
- 代码编辑器 VS Code

## 3. 开发环境搭建步骤

### 3.1 安装Python环境

#### Windows系统
1. 访问 [Python官网](https://www.python.org/downloads/) 下载最新版本的Python安装包
2. 运行安装包，勾选"Add Python to PATH"选项
3. 完成安装后，打开命令提示符，输入 `python --version` 验证安装


### 3.2 配置虚拟环境

创建项目专用的虚拟环境，避免依赖冲突:

1. 创建虚拟环境:
   ```bash
   python3 -m venv photowatermark_env
   ```

2. 激活虚拟环境:
   - **Windows**:
     ```cmd
     photowatermark_env\Scripts\activate
     ```
   - **macOS/Linux**:
     ```bash
     source photowatermark_env/bin/activate
     ```

3. 验证虚拟环境激活:
   - 命令行提示符前应显示环境名称 `(photowatermark_env)`

### 3.3 安装项目依赖

1. 克隆项目代码:
   ```bash
   git clone [项目仓库地址]
   cd PhotoWatermark2
   ```

2. 安装项目依赖:
   ```bash
   pip install -r requirements.txt
   ```

3. 验证依赖安装:
   ```python
   python -c "import PyQt6, PIL, cv2, numpy; print('所有依赖库安装成功')"
   ```

### 3.4 安装开发工具

#### VS Code配置 (推荐)
1. 安装VS Code: [https://code.visualstudio.com/](https://code.visualstudio.com/)
2. 安装必要的扩展:
   - Python (Microsoft)
   - Pylance (Microsoft)
   - Black Formatter (Charles d'Affaire)
   - Python Test Explorer (Little Fox Team)
   - GitLens (Microsoft)

3. 配置VS Code:
   - 创建 `.vscode/settings.json` 文件:
     ```json
     {
         "python.linting.enabled": true,
         "python.linting.pylintEnabled": true,
         "python.formatting.provider": "black",
         "editor.formatOnSave": true,
         "python.analysis.typeCheckingMode": "basic"
     }
     ```

### 3.5 安装Qt Designer

Qt Designer是Qt的UI设计工具，用于设计PyQt界面:

1. 安装PyQt-tools:
   ```bash
   pip install PyQt-tools
   ```

2. 启动Qt Designer:
   ```bash
   designer
   ```

3. 将Qt Designer添加到系统路径 (可选):
   - 在Windows中，可以将Qt Designer的安装路径添加到系统环境变量PATH中
   - 在macOS中，可以创建别名或使用软链接

### 3.6 配置Git

1. 配置Git用户信息:
   ```bash
   git config --global user.name "Your Name"
   git config --global user.email "your.email@example.com"
   ```

2. 设置SSH密钥 (如果使用SSH协议):
   ```bash
   ssh-keygen -t ed25519 -C "your.email@example.com"
   # 按提示完成密钥生成
   # 将公钥添加到GitHub/GitLab账户
   ```

3. 克隆项目代码:
   ```bash
   git clone [项目仓库地址]
   ```

## 4. 项目结构说明

项目采用模块化设计，主要目录结构如下:

```
PhotoWatermarkApp/
├── main.py              # 应用入口
├── resources/           # 资源文件
│   ├── icons/           # 图标文件
│   └── styles/          # 样式文件
├── ui/                  # UI层代码
│   ├── __init__.py
│   ├── main_window.py   # 主窗口
│   ├── image_view.py    # 图片列表视图
│   ├── preview_area.py  # 图片预览区
│   ├── watermark_panel.py # 水印控制面板
│   └── export_panel.py  # 导出设置面板
├── core/                # 业务逻辑层代码
│   ├── __init__.py
│   ├── file_processor.py # 文件处理模块
│   ├── watermark_processor.py # 水印处理模块
│   └── config_manager.py # 配置管理模块
├── data/                # 数据访问层代码
│   ├── __init__.py
│   ├── image_storage.py  # 图片存储
│   ├── template_storage.py # 模板存储
│   └── config_storage.py # 配置存储
├── utils/               # 工具类
│   ├── __init__.py
│   ├── image_utils.py   # 图片处理工具
│   └── ui_utils.py      # UI工具函数
└── requirements.txt     # 依赖包列表
```

## 5. 开发工作流程

### 5.1 代码规范

1. **Python代码风格**:
   - 遵循PEP 8规范
   - 使用Black进行代码格式化
   - 使用4个空格作为缩进
   - 行长度限制为120字符

2. **命名规范**:
   - 类名使用驼峰命名法 (PascalCase)
   - 函数和变量使用小写加下划线 (snake_case)
   - 常量使用全大写加下划线 (UPPER_CASE)
   - 私有成员使用单下划线前缀 (_private)

3. **注释规范**:
   - 模块、类、函数必须有文档字符串
   - 复杂逻辑需要添加行内注释
   - 使用英文编写注释

### 5.2 版本控制流程

1. **分支管理**:
   - `main`: 主分支，保持稳定可运行状态
   - `develop`: 开发分支，用于日常开发
   - `feature/*`: 功能分支，用于开发新功能
   - `bugfix/*`: 修复分支，用于修复bug

2. **提交规范**:
   - 使用清晰的提交信息
   - 格式: `<类型>(<范围>): <描述>`
   - 类型: feat, fix, docs, style, refactor, test, chore
   - 示例: `feat(ui): 添加图片预览功能`

3. **代码审查**:
   - 所有代码变更需要经过Pull Request流程
   - 至少需要一名团队成员审查通过
   - 合并前确保所有测试通过

### 5.3 测试流程

1. **单元测试**:
   - 使用pytest框架编写单元测试
   - 核心功能模块必须有对应的单元测试
   - 测试覆盖率应达到80%以上

2. **运行测试**:
   ```bash
   pytest tests/
   ```

3. **集成测试**:
   - 定期进行集成测试，确保模块间协同工作正常

### 5.4 持续集成

1. **自动化构建**:
   - 使用GitHub Actions或类似工具实现自动化构建
   - 每次代码提交自动运行测试和构建

2. **质量检查**:
   - 自动化代码质量检查
   - 自动化安全漏洞扫描

## 6. 常见问题与解决方案

### 6.1 依赖库安装失败

**问题**: 安装PyQt6时出现错误
**解决方案**:
```bash
# 更新pip和setuptools
pip install --upgrade pip setuptools

# 使用国内镜像源
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple PyQt6

# 或使用conda安装
conda install -c conda-forge pyqt
```

### 6.2 虚拟环境问题

**问题**: 虚拟环境激活失败
**解决方案**:
- Windows: 确保以管理员身份运行命令提示符
- 检查Python版本是否与虚拟环境匹配
- 重新创建虚拟环境

### 6.3 Qt Designer启动失败

**问题**: 运行`designer`命令无响应
**解决方案**:
- 检查PyQt-tools是否正确安装
- 尝试直接从Python启动:
  ```python
  from PyQt6.QtWidgets import QApplication
  from PyQt6.QtDesigner import QDesigner
  import sys
  app = QApplication(sys.argv)
  designer = QDesigner()
  designer.show()
  sys.exit(app.exec())
  ```

### 6.4 图片处理性能问题

**问题**: 处理大图片时应用响应缓慢
**解决方案**:
- 使用多线程处理
- 优化图片处理算法
- 添加内存管理机制

## 7. 调试与性能分析

### 7.1 调试配置

1. **VS Code调试配置**:
   - 创建 `.vscode/launch.json` 文件:
     ```json
     {
         "version": "0.2.0",
         "configurations": [
             {
                 "name": "Python: Current File",
                 "type": "python",
                 "request": "launch",
                 "program": "${file}",
                 "console": "integratedTerminal",
                 "justMyCode": true
             },
             {
                 "name": "Python: PhotoWatermark App",
                 "type": "python",
                 "request": "launch",
                 "program": "${workspaceFolder}/main.py",
                 "console": "integratedTerminal",
                 "justMyCode": true
             }
         ]
     }
     ```

2. **PyCharm调试配置**:
   - 添加新的Python调试配置
   - 设置脚本路径为项目根目录下的main.py
   - 设置工作目录为项目根目录

### 7.2 性能分析

1. **使用cProfile进行性能分析**:
   ```python
   import cProfile
   import pstats

   profiler = cProfile.Profile()
   profiler.enable()

   # 运行需要分析的代码
   main()

   profiler.disable()
   stats = pstats.Stats(profiler).sort_stats('cumulative')
   stats.print_stats()
   ```

2. **使用memory_profiler进行内存分析**:
   ```bash
   pip install memory_profiler
   ```

## 8. 开发环境验证

完成环境配置后，运行以下命令验证开发环境是否正确搭建:

1. 验证Python环境:
   ```bash
   python --version
   ```

2. 验证虚拟环境:
   ```bash
   which python  # Linux/macOS
   where python  # Windows
   ```

3. 验证依赖库:
   ```python
   python -c "
   import PyQt6, PIL, cv2, numpy
   print('PyQt6:', PyQt6.QtCore.PYQT_VERSION_STR)
   print('Pillow:', PIL.__version__)
   print('OpenCV:', cv2.__version__)
   print('NumPy:', numpy.__version__)
   print('所有依赖库安装成功')
   "
   ```

4. 运行项目:
   ```bash
   python main.py
   ```

如果应用能够正常启动，则表示开发环境配置成功。

## 9. 开发环境更新与维护

### 9.1 依赖库更新

定期更新项目依赖库，确保使用最新版本并修复安全漏洞:

```bash
# 生成依赖库的最新版本
pip list --outdated

# 更新所有依赖库
pip list --outdated --format=freeze | grep -v '^\-e' | cut -d = -f 1 | xargs -n1 pip install -U

# 或更新单个依赖库
pip install --upgrade [库名]
```

### 9.2 环境备份

定期备份虚拟环境，便于快速恢复:

```bash
# 使用pipreqs生成当前环境的依赖列表
pip install pipreqs
pipreqs . --force

# 或使用pip freeze导出依赖列表
pip freeze > requirements.txt
```

## 10. 总结

通过遵循本开发环境配置文档，开发人员可以快速搭建完整的开发环境，开始照片水印应用的开发工作。良好的开发环境配置是项目成功的基础，有助于提高开发效率和代码质量。

如有任何问题或建议，请参考项目文档或联系技术负责人。
